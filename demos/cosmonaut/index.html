<!doctype html>
<html lang="en">
	<head>
		<title>First Space Walk</title>
		<meta name="author" content="Luz Caballero">
		<!-- adapted from Three.js example webgl_objconvert_test.html @ https://github.com/mrdoob/three.js-->
		<!-- model by Max Gruter @ http://sketchup.google.com/3dwarehouse/details?mid=85d4348bde062ce224b6cd01a632083a&ct=mdrm -->
		<!-- voskhod 2 image source Gunter's Space Page @ http://space.skyrocket.de/img_sat/voskhod-2__1.jpg-->
		<!-- space walk by Alexey Leonov -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background: url("images/voskhod-2__2.jpg") center center no-repeat #000;
				color: #FFF;
				padding:0;
				margin:0;
				overflow:hidden;
				font-family:'trebuchet ms', 'lucida grande', 'lucida sans unicode', arial, helvetica, sans-serif;
				text-align:center;
			}
			canvas { pointer-events:none; z-index:10;}
			
			p { font-size: small;}

      #log-panel {
        font-family: Arial;
        margin: 0;
        position: fixed;
        top: 0;
        right: 0;
        padding: 5px;
        color: white;
        background-color: red;
        font-weight: bold;
        font-size: 1em;
        z-index: 4000;
      }
      #title {
        text-shadow: 1px 1px 2px black, 0 0 1em blue, 0 0 0.2em blue;
      }
		</style>
	</head>

	<body>
	  <div id="log-panel" style="display:none;">
      <span id="log-message"></span>
    </div>
		  
		<div id="title">  
			<h3>First Space Walk - March 18, 1965</h3>
		</div>
		<script src="scripts/Detector.js"></script>
		<script src="/scripts/threejs/Three.js"></script>
		
		<script src="scripts/RequestAnimationFrame.js"></script>

    <script>
		//Log singleton
      var $ = function(d) { return document.getElementById(d); }, 
        Log = {
      elem: null,
      timer: null,

      getElem: function() {
        if (!this.elem) {
          return (this.elem = $('log-message'));
        }
        return this.elem;
      },

      write: function(text, hide) {
        if (this.timer) {
          this.timer = clearTimeout(this.timer);
        }

        var elem = this.getElem(),
            style = elem.parentNode.style;

        elem.innerHTML = text;
        style.display = '';

        if (hide) {
          this.timer = setTimeout(function() {
            style.display = 'none';
          }, 2000);
        }
      }
    };
		
			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			//var SCREEN_WIDTH = window.innerWidth;
			//var SCREEN_HEIGHT = window.innerHeight;
			var FLOOR = 0;

			var container;

			var camera, scene;
			var webglRenderer;

			var zmesh, geometry;

			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			document.addEventListener( 'touchmove', onDocumentTouchMove, false );
			
			window.addEventListener("deviceorientation", handleOrientation, true);

			init();
			animate();

			function init() {
			  Log.write('Loading...');

				container = document.createElement( 'div' );
				document.body.appendChild( container );
				
				// camera
				//camera = new THREE.PerspectiveCamera( 75, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 100000 );
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100000 );
				camera.position.z = 75;
				
				//scene
				scene = new THREE.Scene();
				
				// renderer
				webglRenderer = new THREE.WebGLRenderer();
				//webglRenderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
				webglRenderer.setSize( window.innerWidth, window.innerHeight );
				webglRenderer.domElement.style.position = "relative";
				container.appendChild( webglRenderer.domElement );
				
				// loader
				var loader = new THREE.JSONLoader(),
					callbackModel   = function( geometry ) { createScene( geometry,  90, FLOOR, -50, 105 ) };
				loader.load( { model: "scripts/cosmonaut.js", callback: callbackModel } );
			}

			function createScene( geometry, x, y, z, b ) {

				zmesh = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial() );
				zmesh.position.set( -10.5, 2.3, 0 );
				zmesh.scale.set( .4, .4, .4 );
				scene.add( zmesh );
				
				Log.write('Done.', true);
			}

			function onDocumentMouseMove(event) {
			  if (event.preventDefault) event.preventDefault();
        if (event.stopPropagation) event.stopPropagation();

				mouseX = ( event.clientX - windowHalfX );
				mouseY = ( event.clientY - windowHalfY );
			}
			
			function onDocumentTouchMove(event) {
			  if (event.preventDefault) event.preventDefault();
        if (event.stopPropagation) event.stopPropagation();

				onDocumentMouseMove(event.touches[0]);
			}

			function animate() {

				requestAnimationFrame( animate );
				render();
			}

			function render() {

				zmesh.rotation.set(mouseY/250 + 2, -mouseX/200, 0);

				webglRenderer.render( scene, camera );
			}
			
			function handleOrientation(event) {

			  webglRenderer.setSize(window.innerWidth, window.innerHeight);
			  camera.aspect = window.innerWidth / window.innerHeight;
			  camera.updateProjectionMatrix();
			  webglRenderer.render( scene, camera );
			}

		</script>

	</body>
</html>
